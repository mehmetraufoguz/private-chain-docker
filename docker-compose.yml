version: '3.8'

services:
  # üß© Private Bootnode
  private-bootnode:
    build:
      context: .
      dockerfile: docker/bootnode/Dockerfile
    command: /abc/bootnode --nodekey bootnode.key --verbosity 3
    networks:
      - node-private

  # üõ†Ô∏è Miners (Private Network)
  miner1:
    build:
      context: .
      dockerfile: docker/miner-geth/Dockerfile
    command: /abc/start.sh
    env_file:
      - ./env/miner.env
      - ./env/miner1.env
    volumes:
      - ./volumes/miner1:/abc/data
      - ./shared/genesis.json:/abc/genesis.json
    networks:
      - node-private

  miner2:
    build:
      context: .
      dockerfile: docker/miner-geth/Dockerfile
    command: /abc/start.sh
    env_file:
      - ./env/miner.env
      - ./env/miner2.env
    volumes:
      - ./volumes/miner2:/abc/data
      - ./shared/genesis.json:/abc/genesis.json
    networks:
      - node-private

  miner3:
    build:
      context: .
      dockerfile: docker/miner-geth/Dockerfile
    command: /abc/start.sh
    env_file:
      - ./env/miner.env
      - ./env/miner3.env
    volumes:
      - ./volumes/miner3:/abc/data
      - ./shared/genesis.json:/abc/genesis.json
    networks:
      - node-private

  # üîÅ Bridge Fullnode (also a fullnode)
  bridge-node:
    image: ethereum/client-go:v1.10.26
    entrypoint: /data/start.sh
    env_file:
      - ./env/node.env
      - ./env/bridge-node.env
    volumes:
      - ./volumes/bridge-node:/data
      - ./shared/genesis.json:/data/genesis.json
      - ./shared/start-node.sh:/data/start.sh
    networks:
      - node-bridge
      - node-private
      - node-public

  # üåç Public Bootnode
  public-bootnode:
    build:
      context: .
      dockerfile: docker/bootnode/Dockerfile
    command: /abc/bootnode --nodekey bootnode.key --verbosity 3
    networks:
      - node-public
    ports:
      - "30301:30301"

  # üåê Public Fullnodes
  public-node1:
    image: ethereum/client-go:v1.10.26
    entrypoint: /data/start.sh
    env_file:
      - ./env/node.env
    ports:
      - "8545:8545"
    volumes:
      - ./volumes/public-node1:/data
      - ./shared/genesis.json:/data/genesis.json
      - ./shared/start-node.sh:/data/start.sh
    networks:
      - node-public

  public-node2:
    image: ethereum/client-go:v1.10.26
    entrypoint: /data/start.sh
    env_file:
      - ./env/node.env
    ports:
      - "8546:8545"
    volumes:
      - ./volumes/public-node2:/data
      - ./shared/genesis.json:/data/genesis.json
      - ./shared/start-node.sh:/data/start.sh
    networks:
      - node-public

  public-node3:
    image: ethereum/client-go:v1.10.26
    entrypoint: /data/start.sh
    env_file:
      - ./env/node.env
    ports:
      - "8547:8545"
    volumes:
      - ./volumes/public-node3:/data
      - ./shared/genesis.json:/data/genesis.json
      - ./shared/start-node.sh:/data/start.sh
    networks:
      - node-public

networks:
  node-private:
  node-bridge:
  node-public:
